@using ProjectBank.Core
@using System.Net
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using Microsoft.Extensions.DependencyInjection
@inject HttpClient _http

<div class="container my-4">
    <div class="row d-flex justify-content-center">
        <div class="px-4 shadow">
            @if (_postComments == null)
            {
                <p>Loading...</p>
            }
            else
            {
                @foreach (var comment in _postComments)
                {
                    <Comment UserID="@comment.UserId" CommentID="@comment.Id" Published="@comment.DateAdded" Content="@comment.Content"></Comment>
                }
            }
            <EditForm Model="commentModel">
                <DataAnnotationsValidator/>
                <ValidationSummary/>
                <div class="d-flex my-4">
                    <div class="col-9">
                        <InputText @bind-Value="commentModel.comment" type="text" id="comment-input" class="form-control" placeholder="Message"/>
                    </div>
                    <div class="col-3 d-flex">
                        <button type="submit" class="btn btn-primary col-12">Comment</button>
                    </div>
                </div>
            </EditForm>
        </div>
    </div>
</div>

@code {
    [Parameter] 
    public PostDto Post { get; set; }

    private IList<CommentDto>? _postComments { get; set; }
    CommentModel commentModel = new CommentModel();

    class CommentModel
    {
        public string comment { get; set; }
    }
    protected override async Task OnInitializedAsync()
    {
        try
        {
            _postComments = await _http.GetFromJsonAsync<List<CommentDto>>("Post/" + Post.Id + "/comments");
        }
        catch (AccessTokenNotAvailableException exception)
        {
            exception.Redirect();
        }
    }
    
    

}